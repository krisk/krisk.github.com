<!DOCTYPE html>
<html>

<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8" />
  <title>AQ | K. Risk - JavaScript Refined</title>
  <meta name="author" content="Kirollos Risk" />
  
  <meta name="description" content="Automated QUnit test framework">
  

  <meta content="width=device-width; initial-scale=1.0; maximum-scale=1.0;" name="viewport">
  <meta content="yes" name="apple-mobile-web-app-capable">
  <meta content="black-translucent" name="apple-mobile-web-app-status-bar-style">

  <!--
    I'm a front-end developer, a JavaScript afficionado, and I like all things web-related.
    If the mark-up of this page looks hideous, we can blame it on Jekyll.  Enjoy.
     - K. Risk
  -->
  
  <meta name="keywords" content="QUnit, automation, test, node.js">
  

  <link rel="alternate" type="application/rss+xml" title="K. Risk - JavaScript Refined" href="/feed.xml" />
  <link href="/css/default.css" rel="stylesheet" type="text/css">

  
    <link rel="stylesheet" href="/css/project.css" type="text/css" />
  
    <link rel="stylesheet" href="/css/pygments.css" type="text/css" />
  
    <link rel="stylesheet" href="/css/examples/fuse.css" type="text/css" />
  


  <script type="text/javascript">

    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-25301489-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();

  </script>
</head>

<body>

  <div id="main">

    <header>
      <div>
        <a href="http://www.kiro.me" id="logo">
          <span>K. Risk -</span>
          <strong>JavaScript Refined</strong>
        </a>
        <nav id="site-nav" role="navigation">
          <ul id="site-menu">
            <li ><a href="/">Home</a></li>
            <li class="selected"><a href="/projects.html">Projects</a></li>
            <li ><a href="/contact.html">Contact</a></li>
          </ul>
        </nav>
      </div>
    </header>

    <div id="container">

      <a href="http://github.com/krisk/aq" target="_blank"><img class="github-fork" src="../images/forkme.png" alt="Fork me on GitHub" /></a>

<h1>AQ</h1>

<div id="share">
  <ul id="share-button-list">
    <!--Facebook -->
    <li>
      <div class="fb-like" data-send="false" data-layout="button_count" data-show-faces="false"></div>
    </li>
    <!--LinkedIn -->
    <li>
      <script type="IN/Share" data-counter="right"></script>
    </li>
    <!--Twitter -->
    <li>
      <a href="https://twitter.com/share" class="twitter-share-button">Tweet</a>
    </li>
    <!-- G+ -->
    <li>
      <g:plusone size="medium"></g:plusone>
    </li>
    <!-- SU -->
    <li>
      <su:badge layout="1"></su:badge>
    </li>
    <!-- Hacker News -->
    <li>
      <a href="http://news.ycombinator.com/submitlink?u=http://www.kiro.me/projects/aq.html&t=AQ" target="_blank" title="Submit AQ to Hacker News">
        <img src="/images/y-comb.gif" />
      </a>
    </li>
  </ul>

  <div id="fb-root"></div>

  <script>
    //Facebook
    (function(d, s, id) {
      var js, fjs = d.getElementsByTagName(s)[0];
      if (d.getElementById(id)) return;
      js = d.createElement(s); js.id = id;
      js.src = "//connect.facebook.net/en_US/all.js#xfbml=1&appId=399955583389436";
      fjs.parentNode.insertBefore(js, fjs);
    }(document, 'script', 'facebook-jssdk'));

    // LinkedIn
    (function() {
      var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
      po.src = '//platform.linkedin.com/in.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
    })();

    //Twitter
    !function(d,s,id){
      var js,fjs=d.getElementsByTagName(s)[0];
      if(!d.getElementById(id)){
        js=d.createElement(s);
        js.id=id;
        js.src="//platform.twitter.com/widgets.js";
        fjs.parentNode.insertBefore(js,fjs);
      }}(document,"script","twitter-wjs");

    // G+
    (function() {
      var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
      po.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
    })();

    // SU
    (function() {
      var li = document.createElement('script'); li.type = 'text/javascript'; li.async = true;
      li.src = 'https://platform.stumbleupon.com/1/widgets.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(li, s);
    })();
  </script>

</div>

<h3 id='qunit_test_automation'>QUnit test automation</h3>

<p>AQ allows you to automate your <a href='http://docs.jquery.com/QUnit'>QUnit</a> tests, leveraging Node.js.</p>

<p><em>(Note: this is still a work in progress. Nonetheless, the base functioality is there, and works)</em></p>

<h2 id='install'>Install</h2>

<p>Use npm to install AQ, and update the package:</p>
<div class='highlight'><pre><code class='javascript'><span class='nx'>npm</span> <span class='nx'>install</span> <span class='nx'>aq</span>
<span class='nx'>npm</span> <span class='nx'>update</span>
</code></pre>
</div>
<h2 id='getting_started'>Getting started</h2>

<p>Create a Node.js server,</p>
<div class='highlight'><pre><code class='js'><span class='nx'>aq</span> <span class='o'>=</span> <span class='nx'>require</span><span class='p'>(</span><span class='s1'>&#39;aq&#39;</span><span class='p'>),</span>

<span class='nx'>app</span> <span class='o'>=</span> <span class='nx'>http</span><span class='p'>.</span><span class='nx'>createServer</span><span class='p'>(</span> <span class='kd'>function</span><span class='p'>(</span> <span class='nx'>request</span><span class='p'>,</span> <span class='nx'>response</span> <span class='p'>)</span> <span class='p'>{</span>
  <span class='c1'>// ..whatever you use to serve content</span>
<span class='p'>}</span> <span class='p'>).</span><span class='nx'>listen</span><span class='p'>(</span> <span class='nx'>port</span> <span class='p'>);</span>

<span class='c1'>// AQ options</span>
<span class='kd'>var</span> <span class='nx'>options</span> <span class='o'>=</span> <span class='p'>{</span>
    <span class='c1'>// Display test results on the terminal</span>
    <span class='nx'>log</span><span class='o'>:</span> <span class='kc'>true</span><span class='p'>,</span>

    <span class='c1'>// Name of the folder where the unit test files reside</span>
    <span class='nx'>testFolder</span><span class='o'>:</span> <span class='s1'>&#39;unit-tests&#39;</span><span class='p'>,</span>

    <span class='c1'>// Directory</span>
    <span class='nx'>dir</span><span class='o'>:</span> <span class='nx'>path</span><span class='p'>.</span><span class='nx'>normalize</span><span class='p'>(</span><span class='nx'>__dirname</span> <span class='o'>+</span> <span class='s1'>&#39;/test/unit-tests/&#39;</span><span class='p'>),</span>

    <span class='c1'>// The test page</span>
    <span class='nx'>page</span><span class='o'>:</span> <span class='s1'>&#39;/test/index.html&#39;</span>
  <span class='p'>};</span>

<span class='c1'>// Let AQ listen to the server</span>
<span class='nx'>aq</span> <span class='o'>=</span> <span class='nx'>aq</span><span class='p'>.</span><span class='nx'>listen</span><span class='p'>(</span><span class='nx'>app</span><span class='p'>,</span> <span class='nx'>options</span><span class='p'>);</span>
</code></pre>
</div>
<h2 id='creating_the_tests'>Creating the tests</h2>

<h3 id='the_test_page'>The test page</h3>

<p>Before you can automate your tests, you first need a page where the tests can run in.</p>

<p>In your test page (perhaps index.html), include AQ and socket.io:</p>
<div class='highlight'><pre><code class='html'><span class='nt'>&lt;script </span><span class='na'>src=</span><span class='s'>&quot;/socket.io/socket.io.js&quot;</span><span class='nt'>&gt;&lt;/script&gt;</span>
<span class='nt'>&lt;script </span><span class='na'>src=</span><span class='s'>&quot;/aq/aq.js&quot;</span><span class='nt'>&gt;&lt;/script&gt;</span>
</code></pre>
</div>
<p>Additionally, there has to be a target container called <code>aq-container</code> where AQ can load the proper unit test into.</p>
<div class='highlight'><pre><code class='html'><span class='nt'>&lt;div</span> <span class='na'>id=</span><span class='s'>&quot;aq-container&quot;</span><span class='nt'>&gt;&lt;/div&gt;</span>
</code></pre>
</div>
<p>AQ will begin testing only when explicitly told. You can do this by calling <code>AQ.start()</code>, in the test page:</p>
<div class='highlight'><pre><code class='js'><span class='nb'>window</span><span class='p'>.</span><span class='nx'>AQ</span><span class='p'>.</span><span class='nx'>start</span><span class='p'>();</span>
</code></pre>
</div>
<h3 id='struture_of_a_unit_test_file'>Struture of a Unit Test file</h3>

<p>Each unit test file within the unit test filder should be an HTML file containing a global <code>run</code> function. This function <strong>must</strong> exist so the test harness can execute the tests defined therein properly.</p>
<div class='highlight'><pre><code class='html'><span class='c'>&lt;!-- Maybe some DOM here --&gt;</span>
<span class='nt'>&lt;script&gt;</span>
    <span class='c1'>// global function needed by AQ</span>
  <span class='kd'>function</span> <span class='nx'>run</span><span class='p'>()</span> <span class='p'>{</span>

    <span class='c1'>// All QUnit tests, modules, etc.. go here.</span>
    <span class='nx'>test</span><span class='p'>(</span><span class='s1'>&#39;some test&#39;</span><span class='p'>,</span> <span class='kd'>function</span><span class='p'>()</span> <span class='p'>{</span>
      <span class='nx'>ok</span><span class='p'>(</span><span class='kc'>true</span><span class='p'>,</span> <span class='s1'>&#39;always true&#39;</span><span class='p'>);</span>
    <span class='p'>}</span>

  <span class='p'>}</span>
<span class='nt'>&lt;/script&gt;</span>
</code></pre>
</div>
<h3 id='how_does_it_all_work'>How does it all work?</h3>

<p>When the server starts, AQ scans the specified directory where the unit tests are contained. Each file name is then returned to the client side. The content of each test file is loaded via an AJAX request, and inserted into <code>aq-container</code>. Once iserted, the <code>run</code> function is called, and the tests are executed. Upon completion of the tests, the next unit test file is loaded.</p>

<p>All tests results (and final results) are passed to the server.</p>

<h2 id='running_the_tests'>Running the tests</h2>

<h3 id='run_all_tests_in_the_unit_test_folder'>Run all tests in the unit test folder</h3>
<div class='highlight'><pre><code class='javascript'><span class='nx'>node</span> <span class='nx'>server</span><span class='p'>.</span><span class='nx'>js</span>
</code></pre>
</div>
<h3 id='command_line_options'>Command line options:</h3>

<h4 id='specify_the_browser'>Specify the browser</h4>

<p>By default, the unit tests will run on all the browsers specified in <code>config.js</code>. To specify the browser, you can use the <code>-b</code> option</p>
<div class='highlight'><pre><code class='javascript'><span class='nx'>node</span> <span class='nx'>server</span><span class='p'>.</span><span class='nx'>js</span> <span class='o'>-</span><span class='nx'>b</span> <span class='nx'>chrome</span>
</code></pre>
</div>
<h4 id='keep_browser_open'>Keep browser open</h4>

<p>By default, after all the unit tests have completed running on a browser, that browser session will close. You can choose to keep the browser open with the <code>-k</code> option</p>
<div class='highlight'><pre><code class='javascript'><span class='nx'>node</span> <span class='nx'>server</span><span class='p'>.</span><span class='nx'>js</span> <span class='o'>-</span><span class='nx'>k</span> <span class='kc'>true</span>
</code></pre>
</div>
<h4 id='how_to_specify_which_unit_tests_to_run'>How to specify which unit tests to run</h4>

<p>Insert the unit tests to run after <code>--</code></p>
<div class='highlight'><pre><code class='javascript'><span class='nx'>node</span> <span class='nx'>server</span><span class='p'>.</span><span class='nx'>js</span> <span class='o'>--</span> <span class='nx'>test1</span><span class='p'>.</span><span class='nx'>html</span> <span class='nx'>test2</span><span class='p'>.</span><span class='nx'>html</span>
</code></pre>
</div>
<h2 id='events'>Events</h2>

<h3 id='on_the_client'>On the client</h3>

<p>AQ provides a <code>beforeTestRun</code> event which is executed after a unit test file is loaded. If this is event is bound, <strong>no test will run unless an explicit call to <code>AQ.run</code> is made.</strong> For example, in the test page:</p>
<div class='highlight'><pre><code class='js'><span class='nb'>window</span><span class='p'>.</span><span class='nx'>AQ</span><span class='p'>.</span><span class='nx'>start</span><span class='p'>();</span>

<span class='nx'>$</span><span class='p'>(</span><span class='nb'>window</span><span class='p'>.</span><span class='nx'>AQ</span><span class='p'>).</span><span class='nx'>on</span><span class='p'>(</span><span class='s1'>&#39;beforeTestRun&#39;</span><span class='p'>,</span> <span class='kd'>function</span><span class='p'>()</span> <span class='p'>{</span>
  <span class='c1'>// .. do some setup before the test</span>
  <span class='nb'>window</span><span class='p'>.</span><span class='nx'>AQ</span><span class='p'>.</span><span class='nx'>run</span><span class='p'>();</span> <span class='c1'>// Run the tests</span>
<span class='p'>});</span>
</code></pre>
</div>
<h3 id='on_the_server'>On the server</h3>

<p>On the server side, once AQ is listening, you can bind onto certain events:</p>
<div class='highlight'><pre><code class='js'><span class='nx'>aq</span> <span class='o'>=</span> <span class='nx'>aq</span><span class='p'>.</span><span class='nx'>listen</span><span class='p'>(</span><span class='nx'>app</span><span class='p'>,</span> <span class='nx'>options</span><span class='p'>);</span>

<span class='cm'>/**</span>
<span class='cm'>* Triggers when a new unit test file is executing</span>
<span class='cm'>*</span>
<span class='cm'>* @param filename {String} name of the file</span>
<span class='cm'>*/</span>
<span class='nx'>aq</span><span class='p'>.</span><span class='nx'>on</span><span class='p'>(</span><span class='s1'>&#39;test-executing&#39;</span><span class='p'>,</span> <span class='kd'>function</span><span class='p'>(</span><span class='nx'>filename</span><span class='p'>)</span> <span class='p'>{</span>
  <span class='nx'>console</span><span class='p'>.</span><span class='nx'>log</span><span class='p'>(</span><span class='nx'>filename</span><span class='p'>);</span>
<span class='p'>});</span>

<span class='cm'>/**</span>
<span class='cm'>* Triggers when a file containing unit tests has completed</span>
<span class='cm'>*</span>
<span class='cm'>* @param data {Object} object literal containing:</span>
<span class='cm'>*  failed: {Int} - number of tests that failed</span>
<span class='cm'>*  passed: {Int} - number of tests that passed</span>
<span class='cm'>*  total: {Int} -  number of tests run</span>
<span class='cm'>*  details: {Array} - list of all tests that failed and their details</span>
<span class='cm'>*/</span>
<span class='nx'>aq</span><span class='p'>.</span><span class='nx'>on</span><span class='p'>(</span><span class='s1'>&#39;test-done&#39;</span><span class='p'>,</span> <span class='kd'>function</span><span class='p'>(</span><span class='nx'>data</span><span class='p'>)</span> <span class='p'>{</span>
  <span class='nx'>console</span><span class='p'>.</span><span class='nx'>log</span><span class='p'>(</span><span class='nx'>data</span><span class='p'>);</span>
<span class='p'>});</span>

<span class='cm'>/**</span>
<span class='cm'>* Triggers when all the unit test files have been executed</span>
<span class='cm'>*</span>
<span class='cm'>* @param data {Object} object literal containing:</span>
<span class='cm'>*  failed: {Int} - number of tests that failed</span>
<span class='cm'>*  passed: {Int} - number of tests that passed</span>
<span class='cm'>*  total: {Int} - number of tests run</span>
<span class='cm'>*/</span>
<span class='nx'>aq</span><span class='p'>.</span><span class='nx'>on</span><span class='p'>(</span><span class='s1'>&#39;done&#39;</span><span class='p'>,</span> <span class='kd'>function</span><span class='p'>(</span><span class='nx'>data</span><span class='p'>)</span> <span class='p'>{</span>
  <span class='nx'>console</span><span class='p'>.</span><span class='nx'>log</span><span class='p'>(</span><span class='nx'>data</span><span class='p'>);</span>
<span class='p'>});</span>
</code></pre>
</div>
<h2 id='problems'>Problems?</h2>

<p>If you encounter any problems, please use the <a href='https://github.com/krisk/aq/issues' title='AQ GiHub Issue tracker'>GitHub issue tracker</a> (GitHub account required).</p>

<p>For anything else, feel free to <a href='mailto:kirollos@gmal.com'>email me</a>, or post a comment below.</p>
<hr />

<div id="disqus_thread"></div>

<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'kiro',
        disqus_title = 'aq',
        disqus_identifier = '1000003';

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>

    </div>

    <div id="sidebar">

      <div id="about-section">
          <h3>About me</h3>

          <p>
            <img id="me-image" src="http://www.gravatar.com/avatar/4ae8dc54def0eb337f21fe40fa8972db.png" />
            I'm <strong>Kiro Risk</strong>, a <strong>Software Engineer</strong> at LinkedIn.  I work with JavaScript, HTML, CSS, Java, Python, MySQL, Objective-C and a plethora of other programming goodness every day.
          </p>

          <p>I live in Silicon Valley.</p>

          <p>
            Questions? Feel free to <a href="mailto:kiro@kiro.me">contact me</a>.
          </p>

          <a href="https://twitter.com/kirorisk" class="twitter-follow-button" data-show-count="false" data-size="large">Follow @kirorisk</a>
          <script>
            !function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");
          </script>

          <p>
            <a id="feedrss" title="Subscribe to this blog..." href="http://feeds.feedburner.com/krisk"><img src="/images/rss2.png"/>Subscribe to the RSS feed</a>
          </p>

          <p>
            <a href="http://www.linkedin.com/in/kirollos">
              <img src="http://www.linkedin.com/img/webpromo/btn_in_20x15.png" width="21" height="16" alt="Kiro Risk's LinkedIn profile" style="vertical-align:top" border="0" />View my LinkedIn profile
            </a>
          </p>

          <p>
            <a id="github-account" href="http://www.github.com/krisk" target="_blank" title="Kiro - GitHub">
              <img src="/images/github.png" width="16" alt="Kiro Risk's LinkedIn profile" style="vertical-align:top" border="0" />GitHub
            </a>
          </p>

      </div>

      <div id="clarify-section">
        <iframe class="clarity-widget" data-c-id="8944" frameborder="0" style="border: 0; height: 0"></iframe>
        <script src="https://clarity.fm/assets/widget_loader.js"></script>
      </div>

    </div>


    <footer>
      <hr />
      <p>Designed and built using Jekyll, and hosted on <a href="http://github.com/krisk/krisk.github.com" target="_blank" title="GitHub page">GitHub</a></p>
      <p>Code licensed under the <a href="http://www.apache.org/licenses/LICENSE-2.0" target="_blank">Apache License v2.0</a></p>
    </footer>

  </div>

  

  

</body>
</html>